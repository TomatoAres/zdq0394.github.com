# 主从复制
## 概述
主从复制是指将一台Redis服务器的数据，复制到其它的Redis服务器。
前者称为主节点(master)，后者称为从节点(slave)；
数据的复制是单向的，只能由主节点到从节点。

默认情况下，每台Redis服务器都是主节点，且一个主节点可以有多个从节点（或没有从节点），但一个从节点只能有一个主节点。

主从复制是Redis高可用的基础。

## 主从复制三个阶段
* 连接建立阶段
* 数据同步阶段
* 命令传播阶段

## 全量复制
全量复制过程：
1. 从节点判断无法进行部分复制，向主节点发送全量复制的请求；或从节点发送部分复制的请求，但主节点判断无法进行全量复制。具体判断过程需要在讲述了部分复制原理后再介绍。
2. 主节点收到全量复制的命令后，执行bgsave，在后台生成RDB文件，并使用一个缓冲区（称为复制缓冲区）记录从现在开始执行的所有写命令。
3. 主节点的bgsave执行完成后，将RDB文件发送给从节点；从节点首先清除自己的旧数据，然后载入接收的RDB文件，将数据库状态更新至主节点执行bgsave时的数据库状态。
4. 主节点将前述复制缓冲区中的所有写命令发送给从节点，从节点执行这些写命令，将数据库状态更新至主节点的最新状态。
5. 如果从节点开启了AOF，则会触发bgrewriteaof的执行，从而保证AOF文件更新至主节点的最新状态。

## 部分复制
Redis2.8开始提供部分复制：psync。

## 参考
https://www.cnblogs.com/kismetv/p/9236731.html