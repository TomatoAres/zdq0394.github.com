# KVM CPU配置
CPU作为计算机系统的“大脑”，是最重要的部分，负责计算机程序指令的执行。

在QEMU/KVM中，**QEMU提供对CPU的模拟，展现给客户机一定的CPU数目和CPU的特性**；在KVM打开的情况下，**客户机中CPU指令的执行由硬件处理器的虚拟化功能（如Intel VT-x和ADM AMD-V）来辅助执行**，具有非常高的执行效率。

## vCPU
QEMU／KVM为客户机提供一套完整的硬件系统环境。

在客户机看来，其所拥有的的CPU即是**vCPU**（virtaul CPU）。在KVM环境中，每个**客户机**都是一个**标准的Linux进程**（QEMU进程），而每个**vCPU**在宿主机中是**QEMU进程**派生的一个**普通线程**。

* 在普通的Linux系统中，进程一般具有**两种执行模式：内核模式和用户模式**。
* 在KVM环境中，增加了第三种模式：**客户模式**。 

vCPU在三种执行模式下的不同分工如下：

* 用户模式：主要处理I/O的模拟和管理，由QEMU的代码实现
* 内核模式：主要处理特别需要高性能和安全相关的指令，如处理客户模式到内核模式的转换，处理客户模式下的I/O指令或其它特权指令引起的退出（VM-Exit），处理影子内存管理（shadow MMU）
* 客户模式：主要执行Guest中的大部分指令，I/O和一些特权指令除外（它们会引起VM-Exit，被Hypervisor截获并模拟）

