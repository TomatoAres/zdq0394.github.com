# 多租户的概述
## 基本概念
多租户技术（英语：multi-tenancy technology）或称**多重租赁技术**，是一种软件架构技术，它是在探讨与实现如何于多用户的环境下共用相同的系统或程序组件，并且仍可确保各用户间**数据的隔离性**。

**为何要多租户？**
因为资源总是紧缺的，需要共享使用，提高资源利用率，降低单均使用成本。
 
**为何要租户隔离？**
不同租户间应用程序不能相互干扰，保证应用的可用性；不同租户间的数据要相互隔离，保证数据安全性和私密性。

多租户需要在最大限度的共享、必要的隔离，这矛盾的两点做好平衡，**没有绝对正确，只有合适的选择**。

多租户技术的实现重点，在于不同租户间应用程序环境的隔离（application context isolation）以及数据的隔离（data isolation)，以维持不同租户间应用程序不会相互干扰，同时数据的保密性也够强。

* 应用程序部份：通过进程或是支持多应用程序同时运行的装载环境（例如Web Server，像是Apache或IIS等）来做进程间的隔离，或是在同一个伺服程序（server）进程内以运行绪的方式隔离。
* 数据部份：通过不同的机制将不同租户的数据隔离，Force是采用中介数据（metadata）的技术来切割，微软 MSDN 的技术文件则是展示了使用结构描述的方式隔离。

多租户（multi-tenancy）是指一个**建立在共同的底层资源上的环境**被**多个租户**共同使用。就像一个大楼一样，许多租户共享大楼的基础设施，比如电梯，但是使用墙和门来在租户之间做隔离；在一个公司内部，敏感部门还需要进一步隔离。

多租户的含义包括两个方面：
* 共享带来经济性
* 隔离保证安全性

## 多租户模型
Gartner提出了7种多租户的部署和实现方式模型，该模型可以作为任何多租户环境的[参考模型](gartner-tenants-model.md)。

## 云环境下的单租户和多租户

* 单租户：一个云环境只被一个租户的用户使用。
* 多租户：云所使用的一种基础性技术，它通过共享硬件或软件来实现云的规模性成本和安全性。云使用多租户技术来在**多个租户和应用**直接安全地共享IT资源。
 
实际上，多租户是在云系统在安全和成本之间的一种妥协（trade-off）：底层资源**共享程度越高**，云系统的**运行成本就越低**、资源**利用率就越高**；然后，这常常会导致**隔离性（isolation）的进一步降低**以及**更高的安全风险（security risk）**。

理论上，各厂商选择的是单位资源成本和租户隔离成本取得最佳平衡点。

## IaaS层面的租户隔离
一个私有云往往是单租户的，因为它部署在一个企业的数据中心内，被该企业内的员工使用。一个公有云往往是多租户的，因为从成本考虑，所有的租户都共享硬件或者软件资源，租户隔离粒度相对较高。但是在某些时候，私有云或者公有云也需要较高的隔离粒度，比如一个公司内的财务部门，出于安全性考虑，需要它所使用的虚机与别的部门使用的虚机隔离开来；比如一个政企部门，在公有云上，要求它的所有虚机或者存储必须在单独的服务器上。这种情况下，可以分为两种隔离粒度：

* 在一个云内的有限隔离粒度：虚机被物理地隔离在指定的服务器上，但是存储和网络实现逻辑隔离就够了。
* 在多个云内的完全隔离：这就是专有云，一个用户完全使用专属物理资源来搭建它的专有云。
 
隔离可以在不同的层面，使用不同的技术实现：
* 物理层面的隔离：这是最完全的隔离，不同的租户使用不同的物理硬件，包括计算和存储服务器和网络设备等。
* 计算在操作系统层面的隔离：虚机，一方面它提供较高的安全隔离性，另一方面，它结合其它技术比如 Linux cgroup 来实现性能保证
* 计算在中间件层面的隔离：比如容器，它共享操作系统等底层资源，使用 Linux namespace 等技术提供一般的隔离性。
* 网络在逻辑层面的隔离：使用 VLAN, VxLAN,GRE 等方式来实现网络流量的逻辑隔离。
* 存储在应用层面的隔离：比如 Ceph 和 Swift 等共享存储，提供应用层面的租户隔离性。
