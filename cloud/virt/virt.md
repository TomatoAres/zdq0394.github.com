## 虚拟化
在X86平台虚拟化技术中，新引入的虚拟化层通常称为虚拟机监控器（Virtual Machine Monitor,VMM），也叫做Hypervisor。

虚拟机监控器的运行环境，也就是真实的物理机平台，称之为**宿主机**。而虚拟出来的平台通常称为**客户机**，里面运行的操作系统对应地也称为**客户机操作系统**。

虚拟机监控器的主要职能是：管理真实的物理硬件平台，并为每个虚拟客户机提供对应的虚拟硬件平台。

***实现虚拟化的重要一步就在于：虚拟化层必须能够截获计算元件对物理资源的直接访问，并将其重定向到虚拟资源池中。***

“截获并重定向”的实现方式：软件虚拟化和硬件虚拟化。

**软件虚拟化**：纯软件的方法在现有的物理平台上实现对物理平台访问的截获和模拟。

QEMU：纯软件仿真，所有的指令都是软件模拟执行。

VMWare：动态二进制翻译，虚拟机监控器在可控制的范围内，允许客户机的指令在物理机平台上直接运行。

但是，客户机指令在运行前会被虚拟机监控器扫描，其中突破虚拟机监控器限制的指令会被动态替换为可以在物理平台上直接运行的安全指令。

**硬件虚拟化**：物理平台本身提供了对特殊指令的截获和重定向的硬件支持。

VMM将客户机置于一种受限制的模式下运行，一旦客户机试图访问物理资源，硬件会暂停客户机的运行，将控制权交回给VMM。

**准虚拟化**：改动客户机操作系统，是它认识到自己运行在虚拟化环境下，能够与虚拟机监控器系统工作。本质上，弱化了对虚拟机特殊指令的被动截获要求，将其转换成客户机操作系统的主动通知。XEN是准虚拟化的例子。

**全虚拟化**：全虚拟化为客户机提供了完整的虚拟X86平台。不需要修改操作系统。KVM

虚拟化模型：
		底层是整个物理系统，主要包括处理器、内存和输入输出设备
		物理系统之上，与以往熟悉的操作系统模型不同，运行的是虚拟机监控器。

虚拟化类型：

**类型一**：虚拟机是在系统上电之后首先加载运行VMM。

VMM一般会提供一个具有一定特权的特殊虚拟机，由这个特殊虚拟机来运行需要提供给用户日常操作和管理使用的操作系统环境。
		ESX/ESXi、Xen、Hyper-V

**类型二**：虚拟机监控程序，在系统上电之后仍然运行一般意义上的操作系统（俗称的宿主机操作系统）。

VMM作为特殊的应用程序，可以视作操作系统功能的扩展。KVM、Virtual Box、VMware Workstation

## 虚拟化实现
经典的虚拟化使用了**陷入-模拟**的模式，而硬件辅助虚拟化引入了**根模式（root operation）和非根模式（none-root operation）**。
每种模式都有ring0-3的四级特权级别。
所以，在硬件辅助虚拟化中，陷入的概念实际上被**VM-EXIT**操作取代了，它代表从非根模式退出到根模式；而从根模式切换到非根模式是**VM-Entry**操作。